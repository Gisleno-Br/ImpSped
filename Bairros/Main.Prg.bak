#include <hmg.ch>

Function Main

        Private cServer := 'LocalHost'
        Private cUserDb := 'root'
        
        Private cPassDb := 'root'
        Private cBanco := 'sisDb'

        Load Window Main
        Main.Center
        Main.Activate

Return


Function Impx()

 Local oServer := GetConexao()
 
 msginfo('Conectado')
 
 USE sz70301 EXCLUSIVE NEW ALIAS CC2

      dbGoTop()
      
      nse1 := 0
      

      WHILE !Eof()
      
         nse1++

        // cUf     := CC2_EST
         //cCodIbge := GetCodUf( cUf ) + CC2_CODMUN
         cMun     := fTiraChar( Z7_MUN )

         cQuery := "INSERT INTO Cep VALUES ( '" + ALLTRIM(Z7_CEP)  + "','" + AllTrim( Z7_ENDER ) + "','" + AllTrim( Z7_EST )  + "','"  + AllTrim( cMun )  + "','" + ;
         + Alltrim(Z7_COMP) +   "','" + Alltrim(Z7_BAIRRO) + "')"
                  
         main.Label_1.value := Z7_CEP
         oQuery := oServer:Query(  cQuery )
         
         IF oServer:NetErr()
            MsGInfo( "Error executing Query " + cQuery + ": " + oServer:Error() )
            EXIT
         ENDIF

         
         dbSkip()
         Do Events
         //Do Events
         

      ENDDO
      
      oQuery:Destroy()

      dbSelectArea( "CC2" )
      USE

      msgBox( "Processo completo!" )
 
  


Return



FUNCTION GetConexao()

   LOCAL oServer
   LOCAL lRet
   LOCAL oQuery

   oServer := TMySQLServer():New( cServer, cUserDb, cPassDb )

   IF oServer:NetErr()
      MsGInfo( "Error ao Conectar SQL Server: " + QUEBRA + oServer:Error() )
      RELEASE Window ALL
      QUIT
   ENDIF

   oServer:SelectDB( cBanco )

   IF oServer:NetErr()
      MsGInfo( "Error ao Conectar Banco " + cBanco + " : " + QUEBRA + oServer:Error() )
      RELEASE Window ALL
      QUIT
   ENDIF

RETURN ( oServer )

FUNCTION fTiraChar( wCampo )

   // // Remover Caracteres Especiais (/,*)

   LOCAL lRet  := .T.
   LOCAL cStr1 := ''
   LOCAL i     := 1

   FOR i := 1 TO Len( wCampo )
      IF SubStr( wCampo, i, 1 ) == "'" .OR. SubStr( wCampo, i, 1 ) == ")" .OR. SubStr( wCampo, i, 1 ) == "(" .OR. SubStr( wCampo, i, 1 ) == "*" .OR. SubStr( wCampo, i, 1 ) == "/"  .OR. SubStr( wCampo, i, 1 ) == "\"  .OR. SubStr( wCampo, i, 1 ) == '%' .OR. SubStr( wCampo, i, 1 ) == "-"

      ELSE
         cStr1 += SubStr( wCampo, i, 1 )
      ENDIF
   NEXT i

   RETURN cStr1

